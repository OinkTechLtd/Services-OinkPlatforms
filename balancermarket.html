<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–µ—Ç–µ–≤–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .launch-button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 24px;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .launch-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .messenger-container {
            background: #2f3136;
            width: 95%;
            height: 95%;
            margin: 2.5% auto;
            border-radius: 10px;
            display: flex;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å–µ—Ä–≤–µ—Ä–æ–≤ */
        .servers-panel {
            width: 70px;
            background: #202225;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            gap: 10px;
        }

        .server-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #5865f2, #738adb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .server-icon:hover {
            border-radius: 15px;
            background: linear-gradient(45deg, #4752c4, #5b6ecd);
        }

        .server-icon.active::before {
            content: '';
            position: absolute;
            left: -15px;
            width: 4px;
            height: 40px;
            background: white;
            border-radius: 2px;
        }

        .add-server {
            background: #36393f !important;
            font-size: 24px;
            color: #b9bbbe;
        }

        .add-server:hover {
            background: #3ba55c !important;
            color: white;
        }

        /* –ü–∞–Ω–µ–ª—å –∫–∞–Ω–∞–ª–æ–≤ */
        .channels-panel {
            width: 240px;
            background: #2f3136;
            display: flex;
            flex-direction: column;
        }

        .server-header {
            height: 60px;
            background: #36393f;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            border-bottom: 1px solid #202225;
            color: white;
            font-weight: bold;
        }

        .channels-list {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
        }

        .channel-category {
            color: #8e9297;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin: 20px 0 5px 0;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            margin: 2px 0;
            border-radius: 4px;
            color: #8e9297;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .channel-item:hover {
            background: #40444b;
            color: #dcddde;
        }

        .channel-item.active {
            background: #42464d;
            color: white;
        }

        .channel-item::before {
            content: '#';
            margin-right: 8px;
            font-weight: bold;
        }

        .voice-channel::before {
            content: 'üîä';
        }

        .bot-channel::before {
            content: 'ü§ñ';
        }

        .bot-channel {
            background: rgba(88, 101, 242, 0.1);
            border: 1px solid rgba(88, 101, 242, 0.3);
        }

        .add-channel, .add-bot {
            background: transparent;
            border: 2px dashed #8e9297;
            color: #8e9297;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
        }

        .add-bot {
            border-color: #5865f2;
            color: #5865f2;
        }

        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #36393f;
        }

        .chat-header {
            height: 60px;
            background: #36393f;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid #202225;
            color: white;
        }

        .chat-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-title::before {
            content: '#';
            color: #8e9297;
            font-size: 20px;
            font-weight: bold;
        }

        .bot-chat-title::before {
            content: 'ü§ñ';
        }

        .chat-controls {
            display: flex;
            gap: 15px;
        }

        .chat-control {
            background: none;
            border: none;
            color: #8e9297;
            cursor: pointer;
            font-size: 20px;
            transition: color 0.2s ease;
        }

        .chat-control:hover {
            color: #dcddde;
        }

        .messages-area {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            display: flex;
            gap: 15px;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s ease;
            position: relative;
        }

        .message:hover {
            background: rgba(255,255,255,0.02);
        }

        .message:hover .message-reactions-btn {
            opacity: 1;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #5865f2, #738adb);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            flex-shrink: 0;
        }

        .bot-message .message-avatar {
            background: linear-gradient(45deg, #faa61a, #f39c12);
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .message-author {
            color: white;
            font-weight: bold;
        }

        .bot-message .message-author {
            color: #faa61a;
        }

        .message-time {
            color: #8e9297;
            font-size: 12px;
        }

        .message-text {
            color: #dcddde;
            line-height: 1.4;
        }

        .bot-badge {
            background: #5865f2;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 12px;
            font-weight: bold;
        }

        /* –†–µ–∞–∫—Ü–∏–∏ –∫ —Å–æ–æ–±—â–µ–Ω–∏—è–º */
        .message-reactions-btn {
            position: absolute;
            top: 5px;
            right: 10px;
            background: #40444b;
            border: none;
            color: #dcddde;
            padding: 5px 8px;
            border-radius: 15px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .message-reactions-btn:hover {
            background: #5865f2;
        }

        .message-reactions {
            display: flex;
            gap: 5px;
            margin-top: 8px;
            flex-wrap: wrap;
        }

        .reaction {
            background: rgba(88, 101, 242, 0.1);
            border: 1px solid rgba(88, 101, 242, 0.3);
            border-radius: 12px;
            padding: 4px 8px;
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 12px;
            color: #dcddde;
        }

        .reaction:hover {
            background: rgba(88, 101, 242, 0.2);
            border-color: rgba(88, 101, 242, 0.5);
        }

        .reaction.active {
            background: rgba(88, 101, 242, 0.3);
            border-color: #5865f2;
        }

        .reactions-picker {
            display: none;
            position: absolute;
            background: #36393f;
            border: 1px solid #202225;
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .reactions-picker.show {
            display: grid;
        }

        .emoji-btn {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            transition: background 0.2s ease;
        }

        .emoji-btn:hover {
            background: #40444b;
        }

        /* –û–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ */
        .input-area {
            padding: 20px;
            background: #40444b;
        }

        .input-container {
            background: #36393f;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input-field {
            flex: 1;
            background: none;
            border: none;
            color: #dcddde;
            font-size: 16px;
            outline: none;
        }

        .input-field::placeholder {
            color: #72767d;
        }

        .input-button {
            background: none;
            border: none;
            color: #8e9297;
            cursor: pointer;
            font-size: 20px;
            padding: 5px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .input-button:hover {
            background: #5865f2;
            color: white;
        }

        /* –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
        .users-panel {
            width: 240px;
            background: #2f3136;
            padding: 20px;
            border-left: 1px solid #202225;
        }

        .users-title {
            color: #8e9297;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 4px;
            margin: 5px 0;
            cursor: pointer;
            transition: background 0.2s ease;
            position: relative;
        }

        .user-item:hover {
            background: #40444b;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #3ba55c, #4fc3f7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
        }

        .user-status {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            border: 2px solid #2f3136;
            border-radius: 50%;
        }

        .status-online { background: #3ba55c; }
        .status-calling { background: #faa61a; animation: pulse 1s infinite; }
        .status-in-call { background: #ed4245; }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }

        .user-name {
            color: #8e9297;
            font-size: 14px;
        }

        .call-button {
            position: absolute;
            right: 8px;
            background: none;
            border: none;
            color: #8e9297;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            font-size: 16px;
        }

        .user-item:hover .call-button {
            opacity: 1;
        }

        .call-button:hover {
            color: #3ba55c;
        }

        /* –û–∫–Ω–æ –∑–≤–æ–Ω–∫–∞ */
        .call-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }

        .call-window {
            background: linear-gradient(135deg, #2f3136, #36393f);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            color: white;
            min-width: 300px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .caller-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #5865f2, #738adb);
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
        }

        .caller-name {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .call-status {
            color: #8e9297;
            margin-bottom: 30px;
        }

        .call-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.2s ease;
        }

        .call-btn.accept {
            background: #3ba55c;
            color: white;
        }

        .call-btn.decline {
            background: #ed4245;
            color: white;
        }

        .call-btn.end {
            background: #ed4245;
            color: white;
        }

        .call-btn:hover {
            transform: scale(1.1);
        }

        /* –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è */
        .close-button {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #8e9297;
            font-size: 30px;
            cursor: pointer;
            z-index: 1001;
            transition: color 0.2s ease;
        }

        .close-button:hover {
            color: #ed4245;
        }

        /* –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .connection-status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #3ba55c;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1001;
        }

        .connection-status.disconnected {
            background: #ed4245;
        }

        .connection-status.connecting {
            background: #faa61a;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è */
        .setup-modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }

        .setup-window {
            background: #2f3136;
            border-radius: 10px;
            padding: 30px;
            color: white;
            min-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .setup-title {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
        }

        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .setup-input {
            background: #36393f;
            border: 1px solid #40444b;
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 16px;
        }

        .setup-input:focus {
            outline: none;
            border-color: #5865f2;
        }

        .setup-button {
            background: #5865f2;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s ease;
        }

        .setup-button:hover {
            background: #4752c4;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-button {
            background: #40444b;
            color: #dcddde;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab-button.active {
            background: #5865f2;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ */
        .bot-modal {
            display: none;
            position: fixed;
            z-index: 3000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            justify-content: center;
            align-items: center;
        }

        .bot-window {
            background: #2f3136;
            border-radius: 10px;
            padding: 30px;
            color: white;
            width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .bot-title {
            font-size: 24px;
            margin-bottom: 20px;
            text-align: center;
            color: #faa61a;
        }

        .bot-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .bot-input {
            background: #36393f;
            border: 1px solid #40444b;
            border-radius: 8px;
            padding: 12px;
            color: white;
            font-size: 16px;
        }

        .bot-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .bot-select {
            background: #36393f;
            border: 1px solid #40444b;
            border-radius: 8px;
            padding: 12px;
            color: white;
        }

        .token-display {
            background: #202225;
            border: 1px solid #40444b;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            word-break: break-all;
            margin: 10px 0;
        }

        .copy-button {
            background: #3ba55c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        /* –°–∫—Ä–æ–ª–ª–±–∞—Ä—ã */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #2f3136;
        }

        ::-webkit-scrollbar-thumb {
            background: #202225;
            border-radius: 4px;
        }

        /* –§–∞–π–ª–æ–≤—ã–π –∏–Ω–ø—É—Ç */
        #file-input {
            display: none;
        }

        /* –ü—Ä–µ–≤—å—é –º–µ–¥–∏–∞ */
        .media-preview {
            max-width: 300px;
            max-height: 200px;
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
        }

        .message-file {
            background: #2f3136;
            border: 1px solid #40444b;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            background: #5865f2;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            color: #00aff4;
            font-weight: bold;
            cursor: pointer;
        }

        .file-size {
            color: #8e9297;
            font-size: 12px;
        }

        .audio-visualizer {
            display: flex;
            align-items: center;
            gap: 2px;
            margin: 10px 0;
        }

        .audio-bar {
            width: 3px;
            height: 20px;
            background: #5865f2;
            border-radius: 2px;
            animation: audioWave 1s infinite ease-in-out;
        }

        .audio-bar:nth-child(2) { animation-delay: 0.1s; }
        .audio-bar:nth-child(3) { animation-delay: 0.2s; }
        .audio-bar:nth-child(4) { animation-delay: 0.3s; }
        .audio-bar:nth-child(5) { animation-delay: 0.4s; }

        @keyframes audioWave {
            0%, 100% { height: 20px; opacity: 0.5; }
            50% { height: 40px; opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–ø—É—Å–∫–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <button class="launch-button" onclick="showSetup()">
        üöÄ –û—Ç–∫—Ä—ã—Ç—å –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä
    </button>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
    <div id="setupModal" class="setup-modal">
        <div class="setup-window">
            <div class="setup-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
            
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('host')">–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
                <button class="tab-button" onclick="switchTab('join')">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
            </div>

            <div id="hostTab" class="tab-content active">
                <div class="setup-form">
                    <input type="text" class="setup-input" id="hostName" placeholder="–í–∞—à–µ –∏–º—è" value="–•–æ—Å—Ç">
                    <input type="text" class="setup-input" id="serverName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞" value="–ú–æ–π —Å–µ—Ä–≤–µ—Ä">
                    <button class="setup-button" onclick="createHost()">–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä</button>
                </div>
            </div>

            <div id="joinTab" class="tab-content">
                <div class="setup-form">
                    <input type="text" class="setup-input" id="userName" placeholder="–í–∞—à–µ –∏–º—è">
                    <input type="text" class="setup-input" id="serverIP" placeholder="IP —Å–µ—Ä–≤–µ—Ä–∞">
                    <button class="setup-button" onclick="joinServer()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ -->
    <div id="messengerModal" class="modal">
        <span class="close-button" onclick="closeMessenger()">&times;</span>
        <div class="connection-status" id="connectionStatus">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>
        
        <div class="messenger-container">
            <!-- –ü–∞–Ω–µ–ª—å —Å–µ—Ä–≤–µ—Ä–æ–≤ -->
            <div class="servers-panel">
                <div class="server-icon active" onclick="selectServer(this, '–ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä')">–ì–°</div>
                <div class="server-icon add-server" onclick="createServer()">+</div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –∫–∞–Ω–∞–ª–æ–≤ -->
            <div class="channels-panel">
                <div class="server-header">
                    <span id="serverName">–ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </div>
                
                <div class="channels-list">
                    <div class="channel-category">–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã</div>
                    <div class="channel-item active" onclick="selectChannel(this, '–æ–±—â–∏–π')">–æ–±—â–∏–π</div>
                    
                    <div class="channel-category">–ë–æ—Ç—ã</div>
                    <div id="botsList"></div>
                    <div class="add-bot" onclick="showBotCreator()">+ –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞</div>
                    
                    <div class="add-channel" onclick="openCreateModal()">+ –°–æ–∑–¥–∞—Ç—å –∫–∞–Ω–∞–ª</div>
                </div>
            </div>

            <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
            <div class="chat-area">
                <div class="chat-header">
                    <div class="chat-title" id="chatTitle">
                        <span id="channelName">–æ–±—â–∏–π</span>
                        <span style="color: #8e9297; font-size: 14px;" id="chatDescription">–°–µ—Ç–µ–≤–æ–π —á–∞—Ç —Å –≥–æ–ª–æ—Å–æ–º –∏ –±–æ—Ç–∞–º–∏</span>
                    </div>
                    <div class="chat-controls">
                        <button class="chat-control" title="–£—á–∞—Å—Ç–Ω–∏–∫–∏">üë•</button>
                        <button class="chat-control" title="–ü–æ–∏—Å–∫">üîç</button>
                        <button class="chat-control" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
                    </div>
                </div>

                <div class="messages-area" id="messagesArea">
                    <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div class="input-area">
                    <div class="input-container">
                        <input type="file" id="file-input" multiple accept="*/*" onchange="handleFileSelect(event)">
                        <button class="input-button" onclick="document.getElementById('file-input').click()" title="–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª">üìé</button>
                        <input type="text" class="input-field" id="messageInput" placeholder="–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeypress="handleKeyPress(event)">
                        <button class="input-button" onclick="sendMessage()" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">üì§</button>
                        <button class="input-button" onclick="sendEmoji()" title="–≠–º–æ–¥–∑–∏">üòä</button>
                    </div>
                </div>
            </div>

            <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
            <div class="users-panel">
                <div class="users-title" id="usersTitle">–£—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Äî 1</div>
                <div id="usersList">
                    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –û–∫–Ω–æ –∑–≤–æ–Ω–∫–∞ -->
        <div id="callModal" class="call-modal">
            <div class="call-window">
                <div class="caller-avatar" id="callerAvatar">–ê–î</div>
                <div class="caller-name" id="callerName">–ê–¥–º–∏–Ω</div>
                <div class="call-status" id="callStatus">–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫...</div>
                <div class="audio-visualizer" id="audioVisualizer" style="display: none;">
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                    <div class="audio-bar"></div>
                </div>
                <div class="call-controls">
                    <button class="call-btn accept" onclick="acceptCall()" title="–ü—Ä–∏–Ω—è—Ç—å">üìû</button>
                    <button class="call-btn decline" onclick="declineCall()" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">üìµ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ -->
    <div id="botModal" class="bot-modal">
        <div class="bot-window">
            <div class="bot-title">ü§ñ BotFather - –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞</div>
            
            <div class="bot-form">
                <input type="text" class="bot-input" id="botName" placeholder="–ò–º—è –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π–ë–æ—Ç)">
                <input type="text" class="bot-input" id="botUsername" placeholder="Username –±–æ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: mybot)">
                <textarea class="bot-input bot-textarea" id="botDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –±–æ—Ç–∞..."></textarea>
                
                <select class="bot-select" id="botType">
                    <option value="echo">–≠—Ö–æ-–±–æ—Ç (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è)</option>
                    <option value="weather">–ü–æ–≥–æ–¥–Ω—ã–π –±–æ—Ç</option>
                    <option value="joke">–ë–æ—Ç —à—É—Ç–æ–∫</option>
                    <option value="admin">–ê–¥–º–∏–Ω-–±–æ—Ç</option>
                    <option value="custom">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π</option>
                </select>

                <div id="customBotSettings" style="display: none;">
                    <textarea class="bot-input bot-textarea" id="botCommands" placeholder="–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ (JSON —Ñ–æ—Ä–º–∞—Ç):
{
  &quot;/start&quot;: &quot;–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –±–æ—Ç!&quot;,
  &quot;/help&quot;: &quot;–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã: /start, /help&quot;
}"></textarea>
                </div>

                <div class="token-display" id="tokenDisplay" style="display: none;">
                    <strong>–¢–æ–∫–µ–Ω –±–æ—Ç–∞:</strong><br>
                    <span id="botToken"></span>
                    <button class="copy-button" onclick="copyToken()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>

                <button class="setup-button" onclick="createBot()">–°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞</button>
                <button class="setup-button" style="background: #ed4245;" onclick="closeBotModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–π -->
    <div id="reactionsPicker" class="reactions-picker">
        <button class="emoji-btn" onclick="addReaction('‚ù§Ô∏è')">‚ù§Ô∏è</button>
        <button class="emoji-btn" onclick="addReaction('üëç')">üëç</button>
        <button class="emoji-btn" onclick="addReaction('üëé')">üëé</button>
        <button class="emoji-btn" onclick="addReaction('üòÇ')">üòÇ</button>
        <button class="emoji-btn" onclick="addReaction('üòÆ')">üòÆ</button>
        <button class="emoji-btn" onclick="addReaction('üò¢')">üò¢</button>
        <button class="emoji-btn" onclick="addReaction('üò°')">üò°</button>
        <button class="emoji-btn" onclick="addReaction('üëè')">üëè</button>
        <button class="emoji-btn" onclick="addReaction('üî•')">üî•</button>
        <button class="emoji-btn" onclick="addReaction('üíØ')">üíØ</button>
        <button class="emoji-btn" onclick="addReaction('üéâ')">üéâ</button>
        <button class="emoji-btn" onclick="addReaction('‚≠ê')">‚≠ê</button>
    </div>

    <!-- –°–∫—Ä—ã—Ç—ã–µ –∞—É–¥–∏–æ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ -->
    <audio id="localAudio" autoplay muted></audio>
    <audio id="remoteAudio" autoplay></audio>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentChannel = '–æ–±—â–∏–π';
        let currentServer = '–ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä';
        let messageHistory = {};
        let currentReactionMessage = null;
        let isInCall = false;
        let currentCall = null;
        let userName = '–í—ã';
        let isHost = false;
        let connectedUsers = [];
        let webSocket = null;
        let localStream = null;
        let remoteStream = null;
        let peerConnection = null;
        let bots = {};
        let currentBotChat = null;

        // WebRTC –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const rtcConfig = {
            iceServers: [
                { urls: 'stun:stun.l.google.com:19302' },
                { urls: 'stun:stun1.l.google.com:19302' }
            ]
        };

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        function showSetup() {
            document.getElementById('setupModal').style.display = 'flex';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ —Ö–æ—Å—Ç–∞
        async function createHost() {
            const hostName = document.getElementById('hostName').value.trim();
            const serverName = document.getElementById('serverName').value.trim();
            
            if (!hostName || !serverName) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            userName = hostName;
            isHost = true;
            currentServer = serverName;
            
            // –°–∏–º—É–ª—è—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞
            await initializeHost();
            
            document.getElementById('setupModal').style.display = 'none';
            openMessenger();
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
        async function joinServer() {
            const name = document.getElementById('userName').value.trim();
            const serverIP = document.getElementById('serverIP').value.trim();
            
            if (!name || !serverIP) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            userName = name;
            isHost = false;
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ WebSocket —Å–µ—Ä–≤–µ—Ä—É
            await connectToServer(serverIP);
            
            document.getElementById('setupModal').style.display = 'none';
            openMessenger();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ö–æ—Å—Ç–∞
        async function initializeHost() {
            updateConnectionStatus('–°–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–Ω', 'connected');
            connectedUsers = [{ name: userName, id: 'host', status: 'online' }];
            updateUsersList();
            addSystemMessage(`–°–µ—Ä–≤–µ—Ä "${currentServer}" —Å–æ–∑–¥–∞–Ω. –í–∞—à IP: ${getLocalIP()}`);
            
            // –°–∏–º—É–ª—è—Ü–∏—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞
            startMockServer();
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
        async function connectToServer(serverIP) {
            updateConnectionStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...', 'connecting');
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            setTimeout(() => {
                updateConnectionStatus('–ü–æ–¥–∫–ª—é—á–µ–Ω', 'connected');
                connectedUsers = [
                    { name: userName, id: 'client', status: 'online' },
                    { name: '–•–æ—Å—Ç', id: 'host', status: 'online' }
                ];
                updateUsersList();
                addSystemMessage(`–ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É ${serverIP}`);
                
                // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
                loadServerHistory();
            }, 2000);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ IP (—Å–∏–º—É–ª—è—Ü–∏—è)
        function getLocalIP() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ IP
            return '192.168.1.' + Math.floor(Math.random() * 255);
        }

        // –ó–∞–ø—É—Å–∫ mock —Å–µ—Ä–≤–µ—Ä–∞
        function startMockServer() {
            // –°–∏–º—É–ª—è—Ü–∏—è WebSocket —Å–µ—Ä–≤–µ—Ä–∞
            setInterval(() => {
                // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                if (Math.random() > 0.95 && connectedUsers.length < 5) {
                    const names = ['–ê–ª–µ–∫—Å–µ–π', '–ú–∞—Ä–∏—è', '–î–º–∏—Ç—Ä–∏–π', '–ê–Ω–Ω–∞', '–°–µ—Ä–≥–µ–π'];
                    const randomName = names[Math.floor(Math.random() * names.length)];
                    
                    if (!connectedUsers.find(u => u.name === randomName)) {
                        connectedUsers.push({
                            name: randomName,
                            id: 'user_' + Date.now(),
                            status: 'online'
                        });
                        updateUsersList();
                        addSystemMessage(`${randomName} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É`);
                    }
                }
            }, 10000);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Å–µ—Ä–≤–µ—Ä–∞
        function loadServerHistory() {
            // –°–∏–º—É–ª—è—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
            const welcomeMessage = {
                author: '–°–µ—Ä–≤–µ—Ä',
                text: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ—Ç–µ–≤–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä! üéâ',
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                avatar: '–°–†',
                reactions: { 'üëã': ['–•–æ—Å—Ç'] },
                id: Date.now() - 1000
            };
            
            addMessageToChat(welcomeMessage);
            saveMessageToHistory(currentChannel, welcomeMessage);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        function updateConnectionStatus(text, status) {
            const statusEl = document.getElementById('connectionStatus');
            statusEl.textContent = text;
            statusEl.className = 'connection-status ' + status;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        function updateUsersList() {
            const usersList = document.getElementById('usersList');
            const usersTitle = document.getElementById('usersTitle');
            
            usersTitle.textContent = `–£—á–∞—Å—Ç–Ω–∏–∫–∏ ‚Äî ${connectedUsers.length}`;
            usersList.innerHTML = '';
            
            connectedUsers.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <div class="user-avatar">
                        ${user.name.substring(0, 2).toUpperCase()}
                        <div class="user-status status-${user.status}"></div>
                    </div>
                    <div class="user-name">${user.name}${user.name === userName ? ' (–í—ã)' : ''}</div>
                    ${user.name !== userName ? `<button class="call-button" onclick="startCall('${user.name}', '${user.name.substring(0, 2).toUpperCase()}')" title="–ü–æ–∑–≤–æ–Ω–∏—Ç—å">üìû</button>` : ''}
                `;
                usersList.appendChild(userDiv);
            });
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
        function openMessenger() {
            document.getElementById('messengerModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
            document.getElementById('serverName').textContent = currentServer;
            loadChannelMessages(currentChannel);
            
            // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
            requestMicrophonePermission();
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
        function closeMessenger() {
            document.getElementById('messengerModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // –û—á–∏—Å—Ç–∫–∞ –∞—É–¥–∏–æ —Ä–µ—Å—É—Ä—Å–æ–≤
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
            }
        }

        // –ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –Ω–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω
        async function requestMicrophonePermission() {
            try {
                localStream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true
                    } 
                });
                
                const localAudio = document.getElementById('localAudio');
                localAudio.srcObject = localStream;
                
                addSystemMessage('üé§ –ú–∏–∫—Ä–æ—Ñ–æ–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é');
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É:', error);
                addSystemMessage('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
            }
        }

        // –§–£–ù–ö–¶–ò–ò –ó–í–û–ù–ö–û–í –° –†–ï–ê–õ–¨–ù–´–ú –ê–£–î–ò–û

        // –ù–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫
        async function startCall(targetUserName, userAvatar) {
            if (isInCall) {
                alert('–í—ã —É–∂–µ –≤ –∑–≤–æ–Ω–∫–µ!');
                return;
            }
            
            if (!localStream) {
                alert('–ú–∏–∫—Ä–æ—Ñ–æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!');
                return;
            }
            
            currentCall = { userName: targetUserName, userAvatar, type: 'outgoing' };
            showCallModal(targetUserName, userAvatar, '–ò—Å—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫...', 'outgoing');
            
            // –°–æ–∑–¥–∞–Ω–∏–µ peer connection
            await createPeerConnection();
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
            localStream.getTracks().forEach(track => {
                peerConnection.addTrack(track, localStream);
            });
            
            // –°–æ–∑–¥–∞–Ω–∏–µ offer
            const offer = await peerConnection.createOffer();
            await peerConnection.setLocalDescription(offer);
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ offer —á–µ—Ä–µ–∑ WebSocket (—Å–∏–º—É–ª—è—Ü–∏—è)
            sendCallSignal('offer', offer, targetUserName);
            
            // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
            setTimeout(() => {
                if (currentCall) {
                    simulateCallAnswer();
                }
            }, 2000 + Math.random() * 3000);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ peer connection
        async function createPeerConnection() {
            peerConnection = new RTCPeerConnection(rtcConfig);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
            peerConnection.onicecandidate = (event) => {
                if (event.candidate) {
                    sendCallSignal('ice-candidate', event.candidate, currentCall.userName);
                }
            };
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
            peerConnection.ontrack = (event) => {
                remoteStream = event.streams[0];
                const remoteAudio = document.getElementById('remoteAudio');
                remoteAudio.srcObject = remoteStream;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–∑—É–∞–ª–∏–∑–∞—Ç–æ—Ä –∞—É–¥–∏–æ
                document.getElementById('audioVisualizer').style.display = 'flex';
            };
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –≤—ã–∑–æ–≤–∞
        function sendCallSignal(type, data, targetUser) {
            const signal = {
                type: 'call-signal',
                signalType: type,
                data: data,
                from: userName,
                to: targetUser,
                timestamp: Date.now()
            };
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WebSocket
            console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–∏–≥–Ω–∞–ª–∞:', signal);
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∑–≤–æ–Ω–æ–∫
        function simulateCallAnswer() {
            if (!currentCall) return;
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–∏–Ω—è—Ç–∏—è –∑–≤–æ–Ω–∫–∞
            if (Math.random() > 0.3) {
                document.getElementById('callStatus').textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
                
                setTimeout(() => {
                    if (currentCall) {
                        acceptCall();
                    }
                }, 1000);
            } else {
                // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
                addSystemMessage(`${currentCall.userName} –æ—Ç–∫–ª–æ–Ω–∏–ª –∑–≤–æ–Ω–æ–∫`);
                endCall();
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–≤–æ–Ω–∫–∞
        function showCallModal(userName, userAvatar, status, type) {
            document.getElementById('callerName').textContent = userName;
            document.getElementById('callerAvatar').textContent = userAvatar;
            document.getElementById('callStatus').textContent = status;
            
            const callModal = document.getElementById('callModal');
            const controls = callModal.querySelector('.call-controls');
            
            if (type === 'incoming') {
                controls.innerHTML = `
                    <button class="call-btn accept" onclick="acceptCall()" title="–ü—Ä–∏–Ω—è—Ç—å">üìû</button>
                    <button class="call-btn decline" onclick="declineCall()" title="–û—Ç–∫–ª–æ–Ω–∏—Ç—å">üìµ</button>
                `;
            } else if (type === 'outgoing') {
                controls.innerHTML = `
                    <button class="call-btn decline" onclick="endCall()" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å">üìµ</button>
                `;
            } else if (type === 'active') {
                controls.innerHTML = `
                    <button class="call-btn end" onclick="endCall()" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫">üìµ</button>
                `;
            }
            
            callModal.style.display = 'flex';
            updateUserCallStatus(userName, 'calling');
        }

        // –ü—Ä–∏–Ω—è—Ç—å –∑–≤–æ–Ω–æ–∫
        function acceptCall() {
            if (!currentCall) return;
            
            isInCall = true;
            document.getElementById('callStatus').textContent = '–í –∑–≤–æ–Ω–∫–µ - –≥–æ–≤–æ—Ä–∏—Ç–µ!';
            document.getElementById('audioVisualizer').style.display = 'flex';
            
            const controls = document.querySelector('.call-controls');
            controls.innerHTML = `
                <button class="call-btn end" onclick="endCall()" title="–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫">üìµ</button>
            `;
            
            updateUserCallStatus(currentCall.userName, 'in-call');
            addSystemMessage(`üìû –ì–æ–ª–æ—Å–æ–≤–æ–π –∑–≤–æ–Ω–æ–∫ —Å ${currentCall.userName} –∞–∫—Ç–∏–≤–µ–Ω`);
            
            // –°–∏–º—É–ª—è—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —á–∞—Ç–∞
            startVoiceSimulation();
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —á–∞—Ç–∞
        function startVoiceSimulation() {
            let phrases = [
                `${currentCall.userName}: –ü—Ä–∏–≤–µ—Ç! –°–ª—ã—à–∏—à—å –º–µ–Ω—è?`,
                `${currentCall.userName}: –°–≤—è–∑—å –æ—Ç–ª–∏—á–Ω–∞—è!`,
                `${currentCall.userName}: –ö–∞–∫ –¥–µ–ª–∞?`,
                `${currentCall.userName}: –≠—Ç–æ—Ç –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∫–ª–∞—Å—Å–Ω—ã–π!`
            ];
            
            let phraseIndex = 0;
            const voiceInterval = setInterval(() => {
                if (!isInCall) {
                    clearInterval(voiceInterval);
                    return;
                }
                
                if (phraseIndex < phrases.length) {
                    addSystemMessage(`üîä ${phrases[phraseIndex]}`);
                    phraseIndex++;
                } else {
                    clearInterval(voiceInterval);
                }
            }, 3000);
        }

        // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–≤–æ–Ω–æ–∫
        function declineCall() {
            if (!currentCall) return;
            
            addSystemMessage(`–ó–≤–æ–Ω–æ–∫ —Å ${currentCall.userName} –æ—Ç–∫–ª–æ–Ω–µ–Ω`);
            endCall();
        }

        // –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫
        function endCall() {
            if (currentCall) {
                updateUserCallStatus(currentCall.userName, 'online');
                addSystemMessage(`–ó–≤–æ–Ω–æ–∫ —Å ${currentCall.userName} –∑–∞–≤–µ—Ä—à–µ–Ω`);
            }
            
            isInCall = false;
            currentCall = null;
            document.getElementById('callModal').style.display = 'none';
            document.getElementById('audioVisualizer').style.display = 'none';
            
            // –û—á–∏—Å—Ç–∫–∞ peer connection
            if (peerConnection) {
                peerConnection.close();
                peerConnection = null;
            }
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∑–≤–æ–Ω–∫–µ
        function updateUserCallStatus(userName, status) {
            const userItems = document.querySelectorAll('.user-item');
            userItems.forEach(item => {
                const nameElement = item.querySelector('.user-name');
                if (nameElement && nameElement.textContent.includes(userName)) {
                    const statusElement = item.querySelector('.user-status');
                    statusElement.className = `user-status status-${status}`;
                }
            });
        }

        // –°–ò–°–¢–ï–ú–ê –ë–û–¢–û–í –ö–ê–ö –í TELEGRAM

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—å –±–æ—Ç–æ–≤
        function showBotCreator() {
            document.getElementById('botModal').style.display = 'flex';
            document.getElementById('botType').addEventListener('change', toggleCustomBotSettings);
        }

        // –ó–∞–∫—Ä—ã—Ç—å —Å–æ–∑–¥–∞—Ç–µ–ª—å –±–æ—Ç–æ–≤
        function closeBotModal() {
            document.getElementById('botModal').style.display = 'none';
            clearBotForm();
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –±–æ—Ç–∞
        function toggleCustomBotSettings() {
            const botType = document.getElementById('botType').value;
            const customSettings = document.getElementById('customBotSettings');
            
            if (botType === 'custom') {
                customSettings.style.display = 'block';
            } else {
                customSettings.style.display = 'none';
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞
        function createBot() {
            const name = document.getElementById('botName').value.trim();
            const username = document.getElementById('botUsername').value.trim();
            const description = document.getElementById('botDescription').value.trim();
            const type = document.getElementById('botType').value;
            
            if (!name || !username) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ username –±–æ—Ç–∞!');
                return;
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
            const token = generateBotToken();
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞ –±–æ—Ç–∞
            const bot = {
                id: 'bot_' + Date.now(),
                name: name,
                username: username.toLowerCase(),
                description: description,
                type: type,
                token: token,
                commands: getBotCommands(type),
                active: true,
                created: new Date()
            };
            
            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–æ—Ç–∞
            bots[bot.id] = bot;
            
            // –ü–æ–∫–∞–∑ —Ç–æ–∫–µ–Ω–∞
            document.getElementById('botToken').textContent = token;
            document.getElementById('tokenDisplay').style.display = 'block';
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            addBotToInterface(bot);
            
            addSystemMessage(`ü§ñ –ë–æ—Ç @${username} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`);
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
        function generateBotToken() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let token = '';
            for (let i = 0; i < 45; i++) {
                token += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return `${Date.now()}:${token}`;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ –ø–æ —Ç–∏–ø—É
        function getBotCommands(type) {
            const commands = {
                echo: {
                    '/start': '–ü—Ä–∏–≤–µ—Ç! –Ø —ç—Ö–æ-–±–æ—Ç. –ë—É–¥—É –ø–æ–≤—Ç–æ—Ä—è—Ç—å –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è!',
                    '/help': '–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å, –∏ —è –ø–æ–≤—Ç–æ—Ä—é!'
                },
                weather: {
                    '/start': '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç –ø–æ–≥–æ–¥—ã. –°–ø—Ä–∞—à–∏–≤–∞–π—Ç–µ –ø—Ä–æ–≥–Ω–æ–∑!',
                    '/weather': '–°–µ–≥–æ–¥–Ω—è —Å–æ–ª–Ω–µ—á–Ω–æ, +20¬∞C',
                    '/help': '–ö–æ–º–∞–Ω–¥—ã: /weather - –ø—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã'
                },
                joke: {
                    '/start': '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç —à—É—Ç–æ–∫. –ü–æ–¥–Ω–∏–º–∞—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ!',
                    '/joke': '–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–µ –ª—é–±—è—Ç –ø—Ä–∏—Ä–æ–¥—É? –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –±–∞–≥–æ–≤! üêõ',
                    '/help': '–ö–æ–º–∞–Ω–¥—ã: /joke - —Å–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞'
                },
                admin: {
                    '/start': '–ü—Ä–∏–≤–µ—Ç! –Ø –∞–¥–º–∏–Ω-–±–æ—Ç. –ü–æ–º–æ–≥–∞—é —É–ø—Ä–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–µ—Ä–æ–º.',
                    '/users': '–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–Ω–ª–∞–π–Ω',
                    '/kick': '–ö–∏–∫–Ω—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)',
                    '/help': '–ö–æ–º–∞–Ω–¥—ã: /users, /kick [–∏–º—è]'
                },
                custom: JSON.parse(document.getElementById('botCommands').value || '{}')
            };
            
            return commands[type] || commands.echo;
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        function addBotToInterface(bot) {
            const botsList = document.getElementById('botsList');
            const botDiv = document.createElement('div');
            botDiv.className = 'channel-item bot-channel';
            botDiv.setAttribute('data-bot-id', bot.id);
            botDiv.textContent = bot.username;
            botDiv.onclick = () => selectBotChat(bot);
            
            botsList.appendChild(botDiv);
        }

        // –í—ã–±–æ—Ä —á–∞—Ç–∞ —Å –±–æ—Ç–æ–º
        function selectBotChat(bot) {
            // –°–±—Ä–æ—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–∞–Ω–∞–ª–æ–≤
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –±–æ—Ç–∞
            const botElement = document.querySelector(`[data-bot-id="${bot.id}"]`);
            if (botElement) {
                botElement.classList.add('active');
            }
            
            currentBotChat = bot;
            currentChannel = `bot_${bot.id}`;
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            const chatTitle = document.getElementById('chatTitle');
            chatTitle.className = 'chat-title bot-chat-title';
            document.getElementById('channelName').textContent = bot.username;
            document.getElementById('chatDescription').textContent = bot.description || '–ß–∞—Ç —Å –±–æ—Ç–æ–º';
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞
            loadBotMessages(bot);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –±–æ—Ç–∞
        function loadBotMessages(bot) {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.innerHTML = '';
            
            if (messageHistory[currentChannel]) {
                messageHistory[currentChannel].forEach(message => {
                    addMessageToChat(message);
                });
            } else {
                // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞
                const welcomeMessage = {
                    author: bot.name,
                    text: bot.commands['/start'] || '–ü—Ä–∏–≤–µ—Ç! –Ø –±–æ—Ç.',
                    time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    avatar: bot.name.substring(0, 2).toUpperCase(),
                    reactions: {},
                    id: Date.now(),
                    isBot: true
                };
                
                addMessageToChat(welcomeMessage);
                saveMessageToHistory(currentChannel, welcomeMessage);
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
        function copyToken() {
            const tokenText = document.getElementById('botToken').textContent;
            navigator.clipboard.writeText(tokenText).then(() => {
                alert('–¢–æ–∫–µ–Ω —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            });
        }

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –±–æ—Ç–∞
        function clearBotForm() {
            document.getElementById('botName').value = '';
            document.getElementById('botUsername').value = '';
            document.getElementById('botDescription').value = '';
            document.getElementById('botType').selectedIndex = 0;
            document.getElementById('botCommands').value = '';
            document.getElementById('tokenDisplay').style.display = 'none';
            document.getElementById('customBotSettings').style.display = 'none';
        }

        // –û–°–¢–ê–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –ú–ï–°–°–ï–ù–î–ñ–ï–†–ê

        // –í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞
        function selectServer(element, serverName) {
            document.querySelectorAll('.server-icon').forEach(icon => {
                icon.classList.remove('active');
            });
            element.classList.add('active');
            document.getElementById('serverName').textContent = serverName;
            currentServer = serverName;
        }

        // –í—ã–±–æ—Ä –∫–∞–Ω–∞–ª–∞
        function selectChannel(element, channelName) {
            document.querySelectorAll('.channel-item').forEach(item => {
                item.classList.remove('active');
            });
            element.classList.add('active');
            
            // –°–±—Ä–æ—Å –±–æ—Ç —á–∞—Ç–∞
            currentBotChat = null;
            const chatTitle = document.getElementById('chatTitle');
            chatTitle.className = 'chat-title';
            
            document.getElementById('channelName').textContent = channelName;
            document.getElementById('chatDescription').textContent = '–°–µ—Ç–µ–≤–æ–π —á–∞—Ç —Å –≥–æ–ª–æ—Å–æ–º –∏ –±–æ—Ç–∞–º–∏';
            
            currentChannel = channelName;
            loadChannelMessages(channelName);
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∫–∞–Ω–∞–ª–∞
        function loadChannelMessages(channel) {
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.innerHTML = '';
            
            if (messageHistory[channel]) {
                messageHistory[channel].forEach(message => {
                    addMessageToChat(message);
                });
            } else {
                addWelcomeMessage(channel);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        function addWelcomeMessage(channel) {
            const welcomeMessage = {
                author: '–°–∏—Å—Ç–µ–º–∞',
                text: `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–∞–Ω–∞–ª #${channel}!`,
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                avatar: '–°–°',
                reactions: {},
                id: Date.now()
            };
            addMessageToChat(welcomeMessage);
            saveMessageToHistory(channel, welcomeMessage);
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (text) {
                const message = {
                    author: userName,
                    text: text,
                    time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    avatar: userName.substring(0, 2).toUpperCase(),
                    reactions: {},
                    id: Date.now()
                };
                
                addMessageToChat(message);
                saveMessageToHistory(currentChannel, message);
                input.value = '';
                
                // –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ —Å–µ—Ç—å (—Å–∏–º—É–ª—è—Ü–∏—è)
                broadcastMessage(message);
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
                if (currentBotChat) {
                    handleBotCommand(text, currentBotChat);
                } else {
                    // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
                    setTimeout(() => {
                        simulateNetworkResponse(text);
                    }, 1000 + Math.random() * 2000);
                }
            }
        }

        // –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —Å–µ—Ç–∏
        function broadcastMessage(message) {
            const networkMessage = {
                type: 'message',
                channel: currentChannel,
                data: message,
                from: userName,
                timestamp: Date.now()
            };
            
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WebSocket
            console.log('–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è:', networkMessage);
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥–∏–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
            setTimeout(() => {
                simulateMessageReceive(networkMessage);
            }, 100);
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è
        function simulateMessageReceive(networkMessage) {
            // –≠–º—É–ª—è—Ü–∏—è —Ä–µ–∞–∫—Ü–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            if (Math.random() > 0.7) {
                const reactions = ['üëç', '‚ù§Ô∏è', 'üòÇ', 'üî•'];
                const randomReaction = reactions[Math.floor(Math.random() * reactions.length)];
                const randomUser = connectedUsers[Math.floor(Math.random() * connectedUsers.length)];
                
                setTimeout(() => {
                    if (randomUser.name !== userName) {
                        addNetworkReaction(networkMessage.data.id, randomReaction, randomUser.name);
                    }
                }, 500 + Math.random() * 1500);
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π —Ä–µ–∞–∫—Ü–∏–∏
        function addNetworkReaction(messageId, emoji, fromUser) {
            // –ù–∞–π—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
            for (const channel in messageHistory) {
                const message = messageHistory[channel].find(msg => msg.id == messageId);
                if (message) {
                    if (!message.reactions[emoji]) {
                        message.reactions[emoji] = [];
                    }
                    if (!message.reactions[emoji].includes(fromUser)) {
                        message.reactions[emoji].push(fromUser);
                        updateMessageReactions(messageId, message.reactions);
                    }
                    break;
                }
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞
        function handleBotCommand(text, bot) {
            setTimeout(() => {
                let response = '';
                
                if (text.startsWith('/')) {
                    // –ö–æ–º–∞–Ω–¥–∞
                    response = bot.commands[text] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /help';
                } else {
                    // –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
                    switch (bot.type) {
                        case 'echo':
                            response = `–í—ã —Å–∫–∞–∑–∞–ª–∏: "${text}"`;
                            break;
                        case 'weather':
                            if (text.toLowerCase().includes('–ø–æ–≥–æ–¥–∞')) {
                                response = '–°–µ–≥–æ–¥–Ω—è —è—Å–Ω–æ, —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ +22¬∞C, –≤–µ—Ç–µ—Ä 5 –º/—Å';
                            } else {
                                response = '–°–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –æ –ø–æ–≥–æ–¥–µ!';
                            }
                            break;
                        case 'joke':
                            const jokes = [
                                '–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é—Ç —Ç–µ–º–Ω—É—é —Ç–µ–º—É? –ü–æ—Ç–æ–º—É —á—Ç–æ —Å–≤–µ—Ç –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –±–∞–≥–∏!',
                                '–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–¥? –ë—ã–≤—à–∏–π.',
                                '–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—É—Ç–∞—é—Ç –†–æ–∂–¥–µ—Å—Ç–≤–æ —Å –•—ç–ª–ª–æ—É–∏–Ω–æ–º? –ü–æ—Ç–æ–º—É —á—Ç–æ Oct 31 == Dec 25!'
                            ];
                            response = jokes[Math.floor(Math.random() * jokes.length)];
                            break;
                        case 'admin':
                            if (text.toLowerCase().includes('–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏')) {
                                response = `–û–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ${connectedUsers.map(u => u.name).join(', ')}`;
                            } else {
                                response = '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã: /users, /kick [–∏–º—è]';
                            }
                            break;
                        default:
                            response = '–Ø –ø–æ–ª—É—á–∏–ª –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!';
                    }
                }
                
                const botMessage = {
                    author: bot.name,
                    text: response,
                    time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    avatar: bot.name.substring(0, 2).toUpperCase(),
                    reactions: {},
                    id: Date.now(),
                    isBot: true
                };
                
                addMessageToChat(botMessage);
                saveMessageToHistory(currentChannel, botMessage);
            }, 500 + Math.random() * 1000);
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∏–∑ —Å–µ—Ç–∏
        function simulateNetworkResponse(userMessage) {
            if (connectedUsers.length <= 1) return;
            
            const responses = [
                '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ!',
                '–°–æ–≥–ª–∞—Å–µ–Ω!',
                '–û—Ç–ª–∏—á–Ω–∞—è –º—ã—Å–ª—å!',
                '–ü–æ–Ω—è—Ç–Ω–æ, —Å–ø–∞—Å–∏–±–æ!',
                '–•–æ—Ä–æ—à–æ —Å–∫–∞–∑–∞–Ω–æ!',
                '–î–∞, —Ç–æ—á–Ω–æ!',
                '–ö–ª–∞—Å—Å–Ω–æ!'
            ];
            
            const otherUsers = connectedUsers.filter(u => u.name !== userName);
            if (otherUsers.length === 0) return;
            
            const randomUser = otherUsers[Math.floor(Math.random() * otherUsers.length)];
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const message = {
                author: randomUser.name,
                text: randomResponse,
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                avatar: randomUser.name.substring(0, 2).toUpperCase(),
                reactions: {},
                id: Date.now()
            };
            
            if (Math.random() > 0.4) {
                addMessageToChat(message);
                saveMessageToHistory(currentChannel, message);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessageToChat(message) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = message.isBot ? 'message bot-message' : 'message';
            messageDiv.dataset.messageId = message.id || Date.now();
            
            const reactionsHtml = message.reactions ? createReactionsHtml(message.reactions) : '';
            const botBadge = message.isBot ? '<span class="bot-badge">BOT</span>' : '';
            
            messageDiv.innerHTML = `
                <div class="message-avatar">${message.avatar}</div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author">${message.author}</span>
                        ${botBadge}
                        <span class="message-time">–°–µ–≥–æ–¥–Ω—è –≤ ${message.time}</span>
                    </div>
                    <div class="message-text">${message.text}</div>
                    ${message.file ? createFileElement(message.file) : ''}
                    ${reactionsHtml}
                </div>
                <button class="message-reactions-btn" onclick="showReactionsPicker(this)">üòä</button>
            `;
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ HTML –¥–ª—è —Ä–µ–∞–∫—Ü–∏–π
        function createReactionsHtml(reactions) {
            if (!reactions || Object.keys(reactions).length === 0) return '';
            
            let html = '<div class="message-reactions">';
            for (const [emoji, users] of Object.entries(reactions)) {
                const isActive = users.includes(userName) ? 'active' : '';
                html += `<div class="reaction ${isActive}" onclick="toggleReaction('${emoji}', this.closest('.message').dataset.messageId)">${emoji} <span>${users.length}</span></div>`;
            }
            html += '</div>';
            return html;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–π
        function showReactionsPicker(button) {
            const picker = document.getElementById('reactionsPicker');
            const rect = button.getBoundingClientRect();
            
            currentReactionMessage = button.closest('.message');
            
            picker.style.top = (rect.top - picker.offsetHeight - 10) + 'px';
            picker.style.left = (rect.left - picker.offsetWidth + 30) + 'px';
            picker.classList.add('show');
            
            setTimeout(() => {
                document.addEventListener('click', hideReactionsPicker);
            }, 100);
        }

        // –°–∫—Ä—ã—Ç—å –ø–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —Ä–µ–∞–∫—Ü–∏–π
        function hideReactionsPicker(event) {
            const picker = document.getElementById('reactionsPicker');
            if (!picker.contains(event.target)) {
                picker.classList.remove('show');
                document.removeEventListener('click', hideReactionsPicker);
            }
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
        function addReaction(emoji) {
            if (!currentReactionMessage) return;
            
            const messageId = currentReactionMessage.dataset.messageId;
            toggleReaction(emoji, messageId);
            
            document.getElementById('reactionsPicker').classList.remove('show');
            document.removeEventListener('click', hideReactionsPicker);
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é
        function toggleReaction(emoji, messageId) {
            let targetMessage = null;
            for (const channel in messageHistory) {
                const message = messageHistory[channel].find(msg => msg.id == messageId);
                if (message) {
                    targetMessage = message;
                    break;
                }
            }
            
            if (!targetMessage) return;
            
            if (!targetMessage.reactions) {
                targetMessage.reactions = {};
            }
            
            if (!targetMessage.reactions[emoji]) {
                targetMessage.reactions[emoji] = [];
            }
            
            const userIndex = targetMessage.reactions[emoji].indexOf(userName);
            if (userIndex > -1) {
                targetMessage.reactions[emoji].splice(userIndex, 1);
                if (targetMessage.reactions[emoji].length === 0) {
                    delete targetMessage.reactions[emoji];
                }
            } else {
                targetMessage.reactions[emoji].push(userName);
            }
            
            updateMessageReactions(messageId, targetMessage.reactions);
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∞–∫—Ü–∏–∏ –≤ —Å–µ—Ç—å
            broadcastReaction(messageId, emoji, 'toggle');
        }

        // –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Ä–µ–∞–∫—Ü–∏–∏
        function broadcastReaction(messageId, emoji, action) {
            const reactionData = {
                type: 'reaction',
                messageId: messageId,
                emoji: emoji,
                action: action,
                from: userName,
                timestamp: Date.now()
            };
            
            console.log('–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è —Ä–µ–∞–∫—Ü–∏–∏:', reactionData);
        }

        // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π
        function updateMessageReactions(messageId, reactions) {
            const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
            if (!messageElement) return;
            
            let reactionsContainer = messageElement.querySelector('.message-reactions');
            
            if (Object.keys(reactions).length === 0) {
                if (reactionsContainer) {
                    reactionsContainer.remove();
                }
                return;
            }
            
            const reactionsHtml = createReactionsHtml(reactions);
            
            if (reactionsContainer) {
                reactionsContainer.outerHTML = reactionsHtml;
            } else {
                const messageContent = messageElement.querySelector('.message-content');
                messageContent.insertAdjacentHTML('beforeend', reactionsHtml);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏–∏
        function saveMessageToHistory(channel, message) {
            if (!messageHistory[channel]) {
                messageHistory[channel] = [];
            }
            messageHistory[channel].push(message);
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
        function addSystemMessage(text) {
            const message = {
                author: '–°–∏—Å—Ç–µ–º–∞',
                text: text,
                time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                avatar: '–°–°',
                reactions: {},
                id: Date.now()
            };
            addMessageToChat(message);
            saveMessageToHistory(currentChannel, message);
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
        function createServer() {
            const serverName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞:');
            if (serverName && serverName.trim()) {
                const serversPanel = document.querySelector('.servers-panel');
                const newServer = document.createElement('div');
                newServer.className = 'server-icon';
                newServer.textContent = serverName.substring(0, 2).toUpperCase();
                newServer.onclick = () => selectServer(newServer, serverName);
                
                const addButton = document.querySelector('.add-server');
                serversPanel.insertBefore(newServer, addButton);
                
                addSystemMessage(`–°–µ—Ä–≤–µ—Ä "${serverName}" –±—ã–ª —Å–æ–∑–¥–∞–Ω!`);
            }
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–∞–Ω–∞–ª–∞
        function openCreateModal() {
            const channelName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞:');
            if (channelName && channelName.trim()) {
                createChannel(channelName, 'text');
            }
        }

        function createChannel(channelName, channelType = 'text') {
            const channelsList = document.querySelector('.channels-list');
            const newChannel = document.createElement('div');
            newChannel.className = 'channel-item';
            
            if (channelType === 'voice') {
                newChannel.classList.add('voice-channel');
            }
            
            newChannel.textContent = channelName;
            newChannel.onclick = () => selectChannel(newChannel, channelName);
            
            const addButton = document.querySelector('.add-channel');
            channelsList.insertBefore(newChannel, addButton);
            
            addSystemMessage(`–ö–∞–Ω–∞–ª #${channelName} –±—ã–ª —Å–æ–∑–¥–∞–Ω!`);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            
            files.forEach(file => {
                const fileUrl = URL.createObjectURL(file);
                const message = {
                    author: userName,
                    text: `–û—Ç–ø—Ä–∞–≤–∏–ª —Ñ–∞–π–ª: ${file.name}`,
                    time: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                    avatar: userName.substring(0, 2).toUpperCase(),
                    reactions: {},
                    id: Date.now(),
                    file: {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        url: fileUrl
                    }
                };
                
                addMessageToChat(message);
                saveMessageToHistory(currentChannel, message);
                broadcastMessage(message);
            });
            
            event.target.value = '';
        }

        function createFileElement(file) {
            if (file.type.startsWith('image/')) {
                return `<img src="${file.url}" class="media-preview" alt="${file.name}" onclick="openMedia('${file.url}')">`;
            } else if (file.type.startsWith('video/')) {
                return `<video src="${file.url}" class="media-preview" controls></video>`;
            } else {
                return `
                    <div class="message-file">
                        <div class="file-icon">üìÑ</div>
                        <div class="file-info">
                            <div class="file-name" onclick="downloadFile('${file.url}', '${file.name}')">${file.name}</div>
                            <div class="file-size">${formatFileSize(file.size)}</div>
                        </div>
                    </div>
                `;
            }
        }

        function formatFileSize(bytes) {
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            if (bytes === 0) return '0 Byte';
            const i = parseInt(Math.floor(Math.log(bytes) / Math.log(1024)));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function openMedia(url) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 3000;
                cursor: pointer;
            `;
            
            const img = document.createElement('img');
            img.src = url;
            img.style.cssText = `
                max-width: 90%;
                max-height: 90%;
                object-fit: contain;
            `;
            
            modal.appendChild(img);
            modal.onclick = () => document.body.removeChild(modal);
            document.body.appendChild(modal);
        }

        function sendEmoji() {
            const emojis = ['üòä', 'üòÇ', '‚ù§Ô∏è', 'üëç', 'üî•', 'üíØ', 'üéâ', 'üòé', 'ü§î', 'üëã'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            document.getElementById('messageInput').value += randomEmoji;
            document.getElementById('messageInput').focus();
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        window.onclick = function(event) {
            const modal = document.getElementById('messengerModal');
            const callModal = document.getElementById('callModal');
            const setupModal = document.getElementById('setupModal');
            const botModal = document.getElementById('botModal');
            
            if (event.target === modal) {
                closeMessenger();
            }
            if (event.target === setupModal) {
                setupModal.style.display = 'none';
            }
            if (event.target === botModal) {
                closeBotModal();
            }
        }

        // –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && event.key === 'k') {
                event.preventDefault();
                showSetup();
            }
            
            if (event.key === 'Escape') {
                const modal = document.getElementById('messengerModal');
                const picker = document.getElementById('reactionsPicker');
                const setupModal = document.getElementById('setupModal');
                const botModal = document.getElementById('botModal');
                
                if (picker.classList.contains('show')) {
                    picker.classList.remove('show');
                } else if (botModal.style.display === 'flex') {
                    closeBotModal();
                } else if (setupModal.style.display === 'flex') {
                    setupModal.style.display = 'none';
                } else if (modal.style.display === 'block') {
                    closeMessenger();
                }
            }
        });

        // Drag & Drop –¥–ª—è —Ñ–∞–π–ª–æ–≤
        function initializeDragDrop() {
            const messagesArea = document.getElementById('messagesArea');
            
            messagesArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                messagesArea.style.background = 'rgba(88, 101, 242, 0.1)';
            });
            
            messagesArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                messagesArea.style.background = '';
            });
            
            messagesArea.addEventListener('drop', function(e) {
                e.preventDefault();
                messagesArea.style.background = '';
                
                const files = Array.from(e.dataTransfer.files);
                handleFileSelect({ target: { files: files } });
            });
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initializeDragDrop();
            
            console.log('üöÄ –°–µ—Ç–µ–≤–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –≥–æ—Ç–æ–≤!');
            console.log('üåê –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è');
            console.log('üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∑–≤–æ–Ω–∫–∏ —Å WebRTC');
            console.log('ü§ñ –°–∏—Å—Ç–µ–º–∞ –±–æ—Ç–æ–≤ –∫–∞–∫ –≤ Telegram');
            console.log('‚å®Ô∏è Ctrl+K - –æ—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏');
        });

        console.log('‚ú® –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ç–µ–≤–æ–π –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä –∑–∞–≥—Ä—É–∂–µ–Ω!');
    </script>
</body>
</html>