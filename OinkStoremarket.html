<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>body {
    font-family: sans-serif;
    margin: 0;
    padding: 20px;
    background-color: #f4f4f4;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background-color: #fff;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

h1, h2 {
    text-align: center;
}

section {
    margin-bottom: 20px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
}

input[type="file"] {
    margin-bottom: 10px;
}

button {
    padding: 10px 15px;
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #3e8e41;
}

p {
    margin-top: 10px;
}
</style>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
</head>
<body>

    <div class="container">
        <h1>TestProject – Для Разработчиков</h1>
Внимание! мы рекомендуем вам стили указывать в самом коде а не отдельно! 
тестируйте свои проекты здесь:) 
удачи вам)
        <section id="archive-upload-section">
            <h2>Загрузить ZIP/RAR/7zip архив</h2>
            <input type="file" id="archiveInput" accept=".zip,.rar,.7z">
            <button id="processArchiveButton">Обработать</button>
            <p id="archiveStatus"></p>
        </section>

        <section id="file-upload-section">
            <h2>Загрузить файл проекта</h2>
            <input type="file" id="fileInput" accept=".html,.php">
            <button id="processFileButton">Обработать</button>
            <p id="fileStatus"></p>
        </section>
    </div>

    <script>
       const archiveInput = document.getElementById('archiveInput');
const processArchiveButton = document.getElementById('processArchiveButton');
const archiveStatus = document.getElementById('archiveStatus');

const fileInput = document.getElementById('fileInput');
const processFileButton = document.getElementById('processFileButton');
const fileStatus = document.getElementById('fileStatus');

// Функция для открытия кода в новой вкладке
function openCodeInNewTab(code, fileType) {
    const newWindow = window.open();
    newWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Просмотр ${fileType.toUpperCase()}</title>
            <style>
                body { font-family: monospace; white-space: pre; }
            </style>
        </head>
        <body>${code}</body>
        </html>
    `);
}


// Обработка загрузки архива
processArchiveButton.addEventListener('click', () => {
    const file = archiveInput.files[0];

    if (file) {
        archiveStatus.textContent = 'Обработка архива Вашего проекта...';

        if (file.name.endsWith('.zip')) {
            JSZip.loadAsync(file)
                .then(zip => {
                    let indexHTML = null;
                    let indexPHP = null;

                    Object.keys(zip.files).forEach(filename => {
                        if (filename.toLowerCase().endsWith('index.html')) {
                            indexHTML = zip.files[filename];
                        } else if (filename.toLowerCase().endsWith('index.php')) {
                            indexPHP = zip.files[filename];
                        }
                    });

                    if (indexHTML) {
                        indexHTML.async('string').then(content => {
                            openCodeInNewTab(content, 'html');
                            archiveStatus.textContent = ' данный файл проекта открыт в новой вкладке.';
                        });
                    } else if (indexPHP) {
                        indexPHP.async('string').then(content => {
                            openCodeInNewTab(content, 'php');
                            archiveStatus.textContent = ' данный файл проекта открыт в новой вкладке..';
                        });
                    } else {
                        archiveStatus.textContent = 'Файлы вашего проекта не найдены в архиве.';
                    }
                })
                .catch(error => {
                    archiveStatus.textContent = 'Ошибка при обработке ZIP архива: ' + error;
                });
        } else {
            archiveStatus.textContent = 'Поддерживаются только ZIP архивы.';
        }
    } else {
        archiveStatus.textContent = 'Пожалуйста, выберите  архив вашего проекта.';
    }
});

// Обработка загрузки файла
processFileButton.addEventListener('click', () => {
    const file = fileInput.files[0];

    if (file) {
        fileStatus.textContent = 'Чтение вашего проекта...';

        const reader = new FileReader();

        reader.onload = (event) => {
            const content = event.target.result;
            if (file.name.endsWith('.html')) {
                openCodeInNewTab(content, 'html');
                fileStatus.textContent = ' данный файл проекта открыт в новой вкладке.';
            } else if (file.name.endsWith('.php')) {
                openCodeInNewTab(content, 'php');
                fileStatus.textContent = 'данный файл проекта открыт в новой вкладке.';
            } else {
                fileStatus.textContent = 'Неподдерживаемый тип файла.';
            }
        };

        reader.onerror = () => {
            fileStatus.textContent = 'Ошибка при чтении файла.';
        };

        reader.readAsText(file);
    } else {
        fileStatus.textContent = 'Пожалуйста, выберите рабочий файл вашего проекта.';
    }
});

    </script>
</body>
</html>
