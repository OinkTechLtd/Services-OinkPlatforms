<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.10/hls.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            user-select: none;
        }

        .app-container {
            position: relative;
            width: 100%;
            height: 100vh;
            max-width: 480px;
            margin: 0 auto;
            background: #000;
            overflow: hidden;
        }

        /* Header */
        .header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 60px 20px 20px;
            background: linear-gradient(180deg, rgba(0,0,0,0.6) 0%, transparent 100%);
        }

        .tab-navigation {
            display: flex;
            gap: 30px;
        }

        .tab-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            font-size: 16px;
            font-weight: 600;
            padding: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-btn.active {
            color: white;
        }

        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: white;
            border-radius: 1px;
        }

        /* Video Container */
        .video-container {
            position: relative;
            height: 100vh;
            overflow: hidden;
        }

        .video-list {
            position: relative;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        .video-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #111;
        }

        .video-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.6);
            text-align: center;
            padding: 40px;
        }

        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Side Controls */
        .side-controls {
            position: absolute;
            right: 15px;
            bottom: 100px;
            z-index: 50;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            border: none;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .control-btn.liked {
            background: rgba(254, 44, 85, 0.8);
        }

        /* Bottom Info */
        .video-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 60px;
            z-index: 50;
            padding: 20px;
            background: linear-gradient(0deg, rgba(0,0,0,0.8) 0%, transparent 100%);
        }

        .video-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .video-description {
            font-size: 14px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 10px;
        }

        .video-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .tag {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* Upload Panel */
        .upload-panel {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            backdrop-filter: blur(10px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .upload-content {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            max-width: 400px;
            width: 100%;
            position: relative;
        }

        .upload-area {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 15px;
            padding: 40px 20px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: rgba(255,255,255,0.6);
            background: rgba(255,255,255,0.05);
        }

        .upload-btn {
            background: linear-gradient(45deg, #ff0050, #ff4081);
            border: none;
            color: white;
            padding: 12px 30px;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 0, 80, 0.3);
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
        }

        /* Swipe Indicator */
        .swipe-indicator {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 40;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .swipe-dot {
            width: 3px;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .swipe-dot.active {
            background: white;
        }

        /* Loading */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 70;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Live Streaming Styles */
        .live-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #ff4444;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            z-index: 60;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .stream-info {
            position: absolute;
            top: 60px;
            left: 20px;
            right: 20px;
            z-index: 60;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .stream-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .stream-viewers {
            font-size: 12px;
            opacity: 0.8;
        }

        .live-controls {
            position: absolute;
            bottom: 120px;
            right: 15px;
            z-index: 60;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .live-control-btn {
            width: 45px;
            height: 45px;
            border-radius: 25px;
            border: none;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .live-control-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .live-control-btn.recording {
            background: rgba(255, 0, 0, 0.8);
        }

        .stream-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 8px;
            font-size: 14px;
        }

        .stream-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .sample-buttons {
            display: flex;
            gap: 8px;
            margin: 10px 0;
            flex-wrap: wrap;
        }

        .sample-btn {
            padding: 6px 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .sample-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .section-buttons {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }

        .section-btn {
            flex: 1;
            padding: 12px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .section-btn.active {
            background: linear-gradient(45deg, #ff0050, #ff4081);
            border-color: transparent;
        }

        .stream-section {
            display: none;
        }

        .stream-section.active {
            display: block;
        }

        /* Play button overlay */
        .play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .play-overlay:hover {
            background: rgba(255,255,255,1);
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                padding: 40px 15px 15px;
            }
            
            .side-controls {
                right: 10px;
                bottom: 80px;
            }
            
            .control-btn {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            .live-controls {
                right: 10px;
                bottom: 100px;
            }

            .upload-content {
                padding: 30px 20px;
                margin: 0 20px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header with Tabs -->
        <div class="header">
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="foryou">–î–ª—è –í–∞—Å</button>
                <button class="tab-btn" data-tab="following">–ü–æ–¥–ø–∏—Å–∫–∏</button>
                <button class="tab-btn" data-tab="live">LIVE</button>
            </div>
        </div>

        <!-- Video Container -->
        <div class="video-container">
            <div class="video-list" id="videoList">
                <!-- Videos will be inserted here -->
            </div>

            <!-- Swipe Indicators -->
            <div class="swipe-indicator" id="swipeIndicator">
                <!-- Dots will be generated here -->
            </div>
        </div>

        <!-- Side Controls -->
        <div class="side-controls">
            <button class="control-btn" onclick="toggleLike()" id="likeBtn">‚ù§Ô∏è</button>
            <button class="control-btn" onclick="toggleMute()" id="muteBtn">üîä</button>
            <button class="control-btn" onclick="shareVideo()">üì§</button>
            <button class="control-btn" onclick="showUploadPanel()">‚ûï</button>
        </div>

        <!-- Video Info -->
        <div class="video-info" id="videoInfo">
            <div class="video-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ VideoApp!</div>
            <div class="video-description">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ–∏ –ø–µ—Ä–≤—ã–µ –≤–∏–¥–µ–æ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä</div>
            <div class="video-tags">
                <span class="tag">#–≤–∏–¥–µ–æ</span>
                <span class="tag">#—Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</span>
            </div>
        </div>

        <!-- Upload Panel -->
        <div class="upload-panel" id="uploadPanel">
            <div class="upload-content">
                <button class="close-btn" onclick="hideUploadPanel()">‚úï</button>
                <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</h2>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìπ</div>
                    <p>–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –≤–∏–¥–µ–æ</p>
                    <p style="font-size: 12px; opacity: 0.6; margin-top: 10px;">MP4, MOV, AVI, WebM –¥–æ 100MB</p>
                </div>
                <input type="file" id="fileInput" accept="video/*" multiple style="display: none;" onchange="handleFileSelect(event)">
                <button class="upload-btn" onclick="document.getElementById('fileInput').click()">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª—ã</button>
            </div>
        </div>

        <!-- Live Panel -->
        <div class="upload-panel" id="livePanel">
            <div class="upload-content">
                <button class="close-btn" onclick="hideLivePanel()">‚úï</button>
                <h2>üî¥ LIVE –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è</h2>
                
                <div class="section-buttons">
                    <button class="section-btn active" onclick="showSection('start')">
                        üì° –ó–∞–ø—É—Å—Ç–∏—Ç—å
                    </button>
                    <button class="section-btn" onclick="showSection('watch')">
                        üì∫ –°–º–æ—Ç—Ä–µ—Ç—å
                    </button>
                </div>

                <!-- Start Stream Section -->
                <div id="startSection" class="stream-section active">
                    <h3>–ó–∞–ø—É—Å–∫ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</h3>
                    <input type="text" id="streamTitleInput" class="stream-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏..." value="–ú–æ—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è">
                    <div class="upload-area" onclick="startWebcamStream()">
                        <div class="upload-icon">üìπ</div>
                        <p>–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é —Å –∫–∞–º–µ—Ä—ã</p>
                        <p style="font-size: 12px; opacity: 0.6; margin-top: 10px;">–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã</p>
                    </div>
                    <button class="upload-btn" onclick="startWebcamStream()">üî¥ –ù–∞—á–∞—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é</button>
                </div>

                <!-- Watch Stream Section -->
                <div id="watchSection" class="stream-section">
                    <h3>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</h3>
                    <input type="text" id="streamUrlInput" class="stream-input" placeholder="HLS/DASH —Å—Å—ã–ª–∫–∞ (m3u8, mpd)...">
                    <div class="sample-buttons">
                        <button class="sample-btn" onclick="addSampleStream('https://tv.mediacdn.ru/live/solntse/playlist.m3u8')">–°–æ–ª–Ω—Ü–µ</button>
                       <button class="sample-btn"onclick="addSampleStream('https://player.smotrim.ru/iframe/stream/live_id/985d5c7b-9727-4942-a4ba-a6e852caf0c1?.m3u8')">–°–æ–ª–æ–≤—å–µ–≤ Live</button>
                    </div>
                    <button class="upload-btn" onclick="addStreamUrl()">üì∫ –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let videos = [];
        let currentVideoIndex = 0;
        let currentTab = 'foryou';
        let isScrolling = false;
        let webcamStream = null;
        let isStreaming = false;

        // Data storage for different tabs
        const tabData = {
            foryou: [],
            following: [],
            live: []
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VideoApp...');
            initializeApp();
            setupEventListeners();
        });

        function initializeApp() {
            // Create initial placeholder if no videos
            if (videos.length === 0) {
                createPlaceholderVideo();
            }
            updateVideoDisplay();
            updateSwipeIndicators();
            console.log('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ');
        }

        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    switchTab(e.target.dataset.tab);
                });
            });

            // Touch events for swiping
            const videoContainer = document.querySelector('.video-container');
            let startY = 0;
            let isDragging = false;

            videoContainer.addEventListener('touchstart', (e) => {
                startY = e.touches[0].clientY;
                isDragging = true;
            });

            videoContainer.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                e.preventDefault();
            });

            videoContainer.addEventListener('touchend', (e) => {
                if (!isDragging) return;
                isDragging = false;

                const endY = e.changedTouches[0].clientY;
                const deltaY = startY - endY;

                if (Math.abs(deltaY) > 50) { // Minimum swipe distance
                    if (deltaY > 0) {
                        nextVideo(); // Swipe up
                    } else {
                        previousVideo(); // Swipe down
                    }
                }
            });

            // Mouse events for desktop
            videoContainer.addEventListener('wheel', (e) => {
                e.preventDefault();
                if (e.deltaY > 0) {
                    nextVideo();
                } else {
                    previousVideo();
                }
            });

            // Keyboard navigation
            document.addEventListener('keydown', (e) => {
                switch(e.key) {
                    case 'ArrowUp':
                        e.preventDefault();
                        previousVideo();
                        break;
                    case 'ArrowDown':
                        e.preventDefault();
                        nextVideo();
                        break;
                    case ' ':
                        e.preventDefault();
                        togglePlayPause();
                        break;
                }
            });

            console.log('–°–æ–±—ã—Ç–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
        }

        function createPlaceholderVideo() {
            const placeholder = {
                id: 'placeholder-' + Date.now(),
                type: 'placeholder',
                title: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ HubApp!',
                description: '–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä',
                tags: ['#–¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å', '#–∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ']
            };
            videos.push(placeholder);
            tabData[currentTab].push(placeholder);
        }

        function createLivePlaceholder() {
            const placeholder = {
                id: 'live-placeholder-' + Date.now(),
                type: 'live-placeholder',
                title: 'üî¥ LIVE –¢—Ä–∞–Ω—Å–ª—è—Ü–∏–∏',
                description: '–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ—é —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é –∏–ª–∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä—è–º—ã–µ —ç—Ñ–∏—Ä—ã',
                tags: ['#live', '#—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏']
            };
            videos.push(placeholder);
            tabData[currentTab].push(placeholder);
        }

        function switchTab(tabName) {
            console.log(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É: ${tabName}`);
            currentTab = tabName;
            
            // Update tab UI
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Switch video content based on tab
            videos = [...(tabData[tabName] || [])];
            console.log(`–í–∏–¥–µ–æ –≤ —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–µ: ${videos.length}`);
            
            if (videos.length === 0) {
                if (tabName === 'live') {
                    createLivePlaceholder();
                } else {
                    createPlaceholderVideo();
                }
            }
            
            currentVideoIndex = 0;
            updateVideoDisplay();
            updateSwipeIndicators();
        }

        function updateVideoDisplay() {
            const videoList = document.getElementById('videoList');
            videoList.innerHTML = '';
            
            console.log(`–û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –í–∏–¥–µ–æ: ${videos.length}, —Ç–µ–∫—É—â–µ–µ: ${currentVideoIndex}`);

            videos.forEach((video, index) => {
                const videoItem = document.createElement('div');
                videoItem.className = 'video-item';
                videoItem.style.transform = `translateY(${(index - currentVideoIndex) * 100}%)`;

                if (video.type === 'placeholder') {
                    videoItem.innerHTML = `
                        <div class="video-placeholder">
                            <div class="upload-icon">üì±</div>
                            <h2>${video.title}</h2>
                            <p>${video.description}</p>
                            <button class="upload-btn" onclick="showUploadPanel()" style="margin-top: 20px;">
                                –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ
                            </button>
                        </div>
                    `;
                } else if (video.type === 'live-placeholder') {
                    videoItem.innerHTML = `
                        <div class="video-placeholder">
                            <div class="upload-icon">üî¥</div>
                            <h2>${video.title}</h2>
                            <p>${video.description}</p>
                            <button class="upload-btn" onclick="showLivePanel()" style="margin-top: 20px;">
                                üî¥ LIVE —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è
                            </button>
                        </div>
                    `;
                } else if (video.type === 'live-stream') {
                    console.log(`–°–æ–∑–¥–∞–µ–º LIVE –ø–æ—Ç–æ–∫: ${video.title}`);
                    
                    const videoElement = document.createElement('video');
                    videoElement.muted = false;
                    videoElement.playsInline = true;
                    videoElement.controls = false;
                    videoElement.autoplay = true;
                    videoElement.volume = 1.0;
                    
                    // HLS/DASH support
                    if (video.url.includes('.m3u8') && typeof Hls !== 'undefined' && Hls.isSupported()) {
                        const hls = new Hls({
                            debug: false,
                            enableWorker: true,
                            lowLatencyMode: true
                        });
                        hls.loadSource(video.url);
                        hls.attachMedia(videoElement);
                        hls.on(Hls.Events.MANIFEST_PARSED, () => {
                            console.log('HLS –º–∞–Ω–∏—Ñ–µ—Å—Ç –∑–∞–≥—Ä—É–∂–µ–Ω');
                            if (index === currentVideoIndex) {
                                videoElement.play().catch(console.error);
                            }
                        });
                        hls.on(Hls.Events.ERROR, (event, data) => {
                            console.error('HLS –æ—à–∏–±–∫–∞:', data);
                            if (data.fatal) {
                                videoItem.innerHTML = `
                                    <div class="video-placeholder">
                                        <div style="color: #ff6b6b;">‚ùå</div>
                                        <h3>–û—à–∏–±–∫–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏</h3>
                                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Ç–æ–∫</p>
                                    </div>
                                `;
                            }
                        });
                    } else {
                        videoElement.src = video.url;
                    }
                    
                    // Live indicators
                    const liveIndicator = document.createElement('div');
                    liveIndicator.className = 'live-indicator';
                    liveIndicator.textContent = 'üî¥ LIVE';
                    
                    const streamInfo = document.createElement('div');
                    streamInfo.className = 'stream-info';
                    streamInfo.innerHTML = `
                        <div class="stream-title">${video.title}</div>
                        <div class="stream-viewers">üëÅ ${Math.floor(Math.random() * 1000) + 100} –∑—Ä–∏—Ç–µ–ª–µ–π</div>
                    `;
                    
                    videoItem.appendChild(videoElement);
                    videoItem.appendChild(liveIndicator);
                    videoItem.appendChild(streamInfo);
                    
                } else if (video.type === 'webcam-stream') {
                    console.log(`–°–æ–∑–¥–∞–µ–º –≤–µ–±-–∫–∞–º–µ—Ä—É –ø–æ—Ç–æ–∫: ${video.title}`);
                    
                    const videoElement = document.createElement('video');
                    videoElement.srcObject = video.stream;
                    videoElement.muted = false;
                    videoElement.playsInline = true;
                    videoElement.controls = false;
                    videoElement.autoplay = true;
                    
                    // Live indicators
                    const liveIndicator = document.createElement('div');
                    liveIndicator.className = 'live-indicator';
                    liveIndicator.textContent = 'üî¥ LIVE';
                    
                    const streamInfo = document.createElement('div');
                    streamInfo.className = 'stream-info';
                    streamInfo.innerHTML = `
                        <div class="stream-title">${video.title}</div>
                        <div class="stream-viewers">üëÅ –¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞</div>
                    `;
                    
                    const liveControls = document.createElement('div');
                    liveControls.className = 'live-controls';
                    liveControls.innerHTML = `
                        <button class="live-control-btn recording" onclick="stopWebcamStream()">‚èπ</button>
                        <button class="live-control-btn" onclick="toggleMute()">üîä</button>
                    `;
                    
                    videoItem.appendChild(videoElement);
                    videoItem.appendChild(liveIndicator);
                    videoItem.appendChild(streamInfo);
                    videoItem.appendChild(liveControls);
                    
                } else {
                    // Regular video
                    console.log(`–°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è: ${video.title}`);
                    
                    const videoElement = document.createElement('video');
                    videoElement.src = video.url;
                    videoElement.loop = true;
                    videoElement.muted = false;
                    videoElement.playsInline = true;
                    videoElement.controls = false;
                    videoElement.preload = 'metadata';
                    videoElement.volume = 1.0;
                    
                    // Event handlers
                    videoElement.onloadstart = () => {
                        console.log(`–ù–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ: ${video.title}`);
                    };
                    
                    videoElement.oncanplay = () => {
                        console.log(`–í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é: ${video.title}`);
                        if (index === currentVideoIndex) {
                            videoElement.muted = false;
                            videoElement.play().catch(e => {
                                console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å–æ –∑–≤—É–∫–æ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –ø—Ä–æ–±—É–µ–º –±–µ–∑ –∑–≤—É–∫–∞');
                                videoElement.muted = true;
                                videoElement.play().catch(e2 => {
                                    console.error('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e2);
                                    showPlayButton(videoItem, videoElement);
                                });
                            });
                        }
                    };
                    
                    videoElement.onerror = (e) => {
                        console.error(`–û—à–∏–±–∫–∞ –≤–∏–¥–µ–æ ${video.title}:`, e);
                        videoItem.innerHTML = `
                            <div class="video-placeholder">
                                <div style="color: #ff6b6b; font-size: 40px;">‚ùå</div>
                                <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h3>
                                <p>${video.title}</p>
                                <p style="font-size: 12px; opacity: 0.6;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª</p>
                            </div>
                        `;
                    };
                    
                    // Click to play/pause
                    videoElement.addEventListener('click', () => {
                        if (videoElement.paused) {
                            videoElement.play();
                        } else {
                            videoElement.pause();
                        }
                    });

                    videoItem.appendChild(videoElement);
                }

                videoList.appendChild(videoItem);
            });

            updateVideoInfo();
        }

        function updateVideoInfo() {
            const videoInfo = document.getElementById('videoInfo');
            const currentVideo = videos[currentVideoIndex];

            if (currentVideo) {
                videoInfo.innerHTML = `
                    <div class="video-title">${currentVideo.title}</div>
                    <div class="video-description">${currentVideo.description}</div>
                    <div class="video-tags">
                        ${currentVideo.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                `;
            }
        }

        function updateSwipeIndicators() {
            const indicator = document.getElementById('swipeIndicator');
            indicator.innerHTML = '';

            for (let i = 0; i < Math.min(videos.length, 5); i++) {
                const dot = document.createElement('div');
                dot.className = `swipe-dot ${i === currentVideoIndex ? 'active' : ''}`;
                indicator.appendChild(dot);
            }
        }

        function nextVideo() {
            if (isScrolling || videos.length <= 1) return;
            isScrolling = true;

            pauseCurrentVideo();
            currentVideoIndex = (currentVideoIndex + 1) % videos.length;
            updateVideoPositions();
            updateSwipeIndicators();
            updateVideoInfo();

            setTimeout(() => {
                playCurrentVideo();
                isScrolling = false;
            }, 400);
        }

        function previousVideo() {
            if (isScrolling || videos.length <= 1) return;
            isScrolling = true;

            pauseCurrentVideo();
            currentVideoIndex = currentVideoIndex === 0 ? videos.length - 1 : currentVideoIndex - 1;
            updateVideoPositions();
            updateSwipeIndicators();
            updateVideoInfo();

            setTimeout(() => {
                playCurrentVideo();
                isScrolling = false;
            }, 400);
        }

        function updateVideoPositions() {
            const videoItems = document.querySelectorAll('.video-item');
            videoItems.forEach((item, index) => {
                item.style.transform = `translateY(${(index - currentVideoIndex) * 100}%)`;
            });
        }

        function playCurrentVideo() {
            const currentItem = document.querySelectorAll('.video-item')[currentVideoIndex];
            if (currentItem) {
                const video = currentItem.querySelector('video');
                if (video) {
                    console.log(`–ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –≤–∏–¥–µ–æ ${currentVideoIndex}`);
                    video.currentTime = 0;
                    
                    video.muted = false;
                    video.play().catch(e => {
                        console.log('–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —Å–æ –∑–≤—É–∫–æ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ, –ø—Ä–æ–±—É–µ–º –±–µ–∑ –∑–≤—É–∫–∞');
                        video.muted = true;
                        video.play().catch(e2 => {
                            console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e2);
                            showPlayButton(currentItem, video);
                        });
                    });
                }
            }
        }

        function pauseCurrentVideo() {
            const videoItems = document.querySelectorAll('.video-item');
            videoItems.forEach((item, index) => {
                const video = item.querySelector('video');
                if (video && !video.paused) {
                    video.pause();
                }
            });
        }

        function togglePlayPause() {
            const currentItem = document.querySelectorAll('.video-item')[currentVideoIndex];
            if (currentItem) {
                const video = currentItem.querySelector('video');
                if (video) {
                    if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                }
            }
        }

        // Control functions
        function toggleLike() {
            const likeBtn = document.getElementById('likeBtn');
            likeBtn.classList.toggle('liked');
            console.log('–õ–∞–π–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω');
        }

        function toggleMute() {
            const currentItem = document.querySelectorAll('.video-item')[currentVideoIndex];
            const muteBtn = document.getElementById('muteBtn');
            
            if (currentItem) {
                const video = currentItem.querySelector('video');
                if (video) {
                    video.muted = !video.muted;
                    muteBtn.innerHTML = video.muted ? 'üîá' : 'üîä';
                    console.log(`–ó–≤—É–∫ ${video.muted ? '–≤—ã–∫–ª—é—á–µ–Ω' : '–≤–∫–ª—é—á–µ–Ω'}`);
                }
            }
        }

        function shareVideo() {
            if (navigator.share) {
                navigator.share({
                    title: '–ü–æ—Å–º–æ—Ç—Ä–∏ —ç—Ç–æ –≤–∏–¥–µ–æ!',
                    text: '–ö—Ä—É—Ç–æ–µ –≤–∏–¥–µ–æ –∏–∑ VideoApp',
                    url: window.location.href
                });
            } else {
                // Fallback
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
                }).catch(() => {
                    alert('–§—É–Ω–∫—Ü–∏—è "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è" –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö!');
                });
            }
        }

        // Upload Panel functions
        function showUploadPanel() {
            document.getElementById('uploadPanel').style.display = 'flex';
        }

        function hideUploadPanel() {
            document.getElementById('uploadPanel').style.display = 'none';
        }

        // Live Panel functions
        function showLivePanel() {
            document.getElementById('livePanel').style.display = 'flex';
        }

        function hideLivePanel() {
            document.getElementById('livePanel').style.display = 'none';
        }

        function showSection(sectionName) {
            // Update buttons
            document.querySelectorAll('.section-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Show/hide sections
            document.querySelectorAll('.stream-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionName + 'Section').classList.add('active');
        }

        // Webcam streaming functions
        async function startWebcamStream() {
            try {
                console.log('–ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ...');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 }, 
                        height: { ideal: 720 },
                        facingMode: 'user'
                    }, 
                    audio: true 
                });
                
                const title = document.getElementById('streamTitleInput').value || '–ú–æ—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è';
                
                const webcamVideo = {
                    id: 'webcam-' + Date.now(),
                    type: 'webcam-stream',
                    title: title,
                    description: `–ü—Ä—è–º–∞—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è: ${new Date().toLocaleTimeString()}`,
                    tags: ['#live', '#—Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è', '#webcam'],
                    stream: stream
                };

                // Remove placeholder if exists
                if (videos.length === 1 && (videos[0].type === 'live-placeholder' || videos[0].type === 'placeholder')) {
                    videos = [];
                    tabData[currentTab] = [];
                }

                tabData[currentTab].push(webcamVideo);
                videos.push(webcamVideo);
                webcamStream = stream;
                isStreaming = true;

                currentVideoIndex = videos.length - 1;
                updateVideoDisplay();
                updateSwipeIndicators();
                hideLivePanel();

                console.log('Webcam —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è –∑–∞–ø—É—â–µ–Ω–∞:', title);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ:', error);
                alert('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–∞.');
            }
        }

        function stopWebcamStream() {
            if (webcamStream) {
                console.log('–û—Å—Ç–∞–Ω–æ–≤–∫–∞ webcam —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏...');
                webcamStream.getTracks().forEach(track => track.stop());
                webcamStream = null;
                isStreaming = false;
                
                // Remove webcam stream from videos
                const webcamIndex = videos.findIndex(v => v.type === 'webcam-stream');
                if (webcamIndex !== -1) {
                    videos.splice(webcamIndex, 1);
                    tabData[currentTab] = tabData[currentTab].filter(v => v.type !== 'webcam-stream');
                }
                
                if (videos.length === 0) {
                    createLivePlaceholder();
                }
                
                currentVideoIndex = Math.min(currentVideoIndex, videos.length - 1);
                updateVideoDisplay();
                updateSwipeIndicators();
                
                console.log('–¢—Ä–∞–Ω—Å–ª—è—Ü–∏—è –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞');
            }
        }

        // Stream URL functions
        function addSampleStream(url) {
            document.getElementById('streamUrlInput').value = url;
        }

        function addStreamUrl() {
            const url = document.getElementById('streamUrlInput').value.trim();
            
            if (!url) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é');
                return;
            }

            console.log('–î–æ–±–∞–≤–ª—è–µ–º –≤–Ω–µ—à–Ω—é—é —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—é:', url);

            const streamVideo = {
                id: 'stream-' + Date.now(),
                type: 'live-stream',
                title: '–í–Ω–µ—à–Ω—è—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è',
                description: `${getStreamType(url)} –ø–æ—Ç–æ–∫: ${new Date().toLocaleTimeString()}`,
                tags: ['#live', '#stream', getStreamType(url).toLowerCase()],
                url: url
            };

            // Remove placeholder if exists
            if (videos.length === 1 && (videos[0].type === 'live-placeholder' || videos[0].type === 'placeholder')) {
                videos = [];
                tabData[currentTab] = [];
            }

            tabData[currentTab].push(streamVideo);
            videos.push(streamVideo);

            currentVideoIndex = videos.length - 1;
            updateVideoDisplay();
            updateSwipeIndicators();
            hideLivePanel();
            
            // Clear input
            document.getElementById('streamUrlInput').value = '';

            console.log('–î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–Ω–µ—à–Ω—è—è —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏—è');
        }

        function getStreamType(url) {
            if (url.includes('.m3u8')) return 'HLS';
            if (url.includes('.mpd')) return 'DASH';
            return 'Stream';
        }

        // File upload functions
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            
            console.log(`–í—ã–±—Ä–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: ${files.length}`);
            
            if (files.length === 0) {
                return;
            }
            
            showLoading();
            
            const videoFiles = files.filter(file => file.type.startsWith('video/'));
            
            console.log(`–í–∏–¥–µ–æ—Ñ–∞–π–ª–æ–≤ –Ω–∞–π–¥–µ–Ω–æ: ${videoFiles.length}`);
            
            if (videoFiles.length === 0) {
                hideLoading();
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª—ã');
                return;
            }

            // Remove placeholder if it exists
            if (videos.length === 1 && (videos[0].type === 'placeholder' || videos[0].type === 'live-placeholder')) {
                videos = [];
                tabData[currentTab] = [];
                currentVideoIndex = 0;
                console.log('–£–¥–∞–ª—è–µ–º placeholder');
            }

            let processedFiles = 0;

            videoFiles.forEach((file, index) => {
                console.log(`–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª: ${file.name}, —Ä–∞–∑–º–µ—Ä: ${(file.size/1024/1024).toFixed(2)}MB`);
                
                try {
                    const videoUrl = URL.createObjectURL(file);
                    console.log(`URL —Å–æ–∑–¥–∞–Ω –¥–ª—è ${file.name}`);
                    
                    const newVideo = {
                        id: Date.now() + '-' + index,
                        url: videoUrl,
                        title: file.name.replace(/\.[^/.]+$/, ""),
                        description: `–ó–∞–≥—Ä—É–∂–µ–Ω–æ: ${new Date().toLocaleTimeString()}`,
                        tags: ['#–º–æ–µ –≤–∏–¥–µ–æ', '#–∑–∞–≥—Ä—É–∂–µ–Ω–æ'],
                        file: file,
                        type: 'video'
                    };

                    tabData[currentTab].push(newVideo);
                    videos.push(newVideo);
                    console.log(`–í–∏–¥–µ–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ: ${newVideo.title}`);
                    
                } catch (error) {
                    console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ URL –¥–ª—è ${file.name}:`, error);
                }
                
                processedFiles++;
                if (processedFiles === videoFiles.length) {
                    console.log(`–í—Å–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã. –í—Å–µ–≥–æ –≤–∏–¥–µ–æ: ${videos.length}`);
                    hideLoading();
                    updateVideoDisplay();
                    updateSwipeIndicators();
                    hideUploadPanel();
                    
                    // Reset file input
                    event.target.value = '';
                }
            });
        }

        // Utility functions
        function showLoading() {
            const loading = document.createElement('div');
            loading.id = 'loadingSpinner';
            loading.className = 'loading';
            loading.innerHTML = '<div class="spinner"></div>';
            document.body.appendChild(loading);
        }
        
        function hideLoading() {
            const loading = document.getElementById('loadingSpinner');
            if (loading) {
                loading.remove();
            }
        }
        
        function showPlayButton(container, videoElement) {
            const playBtn = document.createElement('div');
            playBtn.className = 'play-overlay';
            playBtn.innerHTML = '‚ñ∂Ô∏è';
            playBtn.onclick = () => {
                videoElement.muted = false;
                const muteBtn = document.getElementById('muteBtn');
                muteBtn.innerHTML = 'üîä';
                
                videoElement.play().then(() => {
                    console.log('–í–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ —Å–æ –∑–≤—É–∫–æ–º');
                }).catch(e => {
                    console.error('–û—à–∏–±–∫–∞ —Ä—É—á–Ω–æ–≥–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e);
                });
                playBtn.remove();
            };
            
            container.style.position = 'relative';
            container.appendChild(playBtn);
        }

        // Cleanup when page unloads
        window.addEventListener('beforeunload', () => {
            if (webcamStream) {
                webcamStream.getTracks().forEach(track => track.stop());
            }
            
            // Cleanup object URLs
            videos.forEach(video => {
                if (video.url && video.url.startsWith('blob:')) {
                    URL.revokeObjectURL(video.url);
                }
            });
        });
    </script>
</body>
</html>